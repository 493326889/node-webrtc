<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>webrtc</title>
</head>
<body>
	<script>
		var host = '127.0.0.1';
		var bridge = host + ':9001';
		var ws = null;
			var pc = new window.RTCPeerConnection();
			var offerOptions = {
				offerToReceiveAudio: 1,
				offerToReceiveVideo: 1
			};

			function createOffer() {
				var offer = pc.createOffer(
					offerOptions
				).then(
					setLocalSDP,
					doHandleError
					);
				pc.onIceCandidate = function(e) {
					console.log(e)
				}
			}
			function setLocalSDP(desc) {
			pc.setLocalDescription(desc).then(
				doSendOffer(desc),
				doHandleError
			)	
		}
		function setRemoteSDP(desc) {
			pc.setRemoteDescription(desc).then(
				doWaitForDataChanel,
				doHandleError
			)
		}
		function doSendOffer(offer) {
			ws = new WebSocket("ws://" + bridge);
			ws.onopen = function () {
				console.log('sdp', offer.sdp);
				ws.send(JSON.stringify(
					{ 'type': offer.type, 'sdp': offer.sdp })
				);
			}
			ws.onmessage = function(event) {
				var data = JSON.parse(event.data);
				if ('answer' === data.type) {
					setRemoteSDP(data)
				}
			}
		}

		function doWaitForDataChanel() {
			console.log('wait data chanel')
		}

		function doHandleError(err) {
			console.log(err)
		}

		createOffer();
	</script>
	test webrtc
</body>
</html>